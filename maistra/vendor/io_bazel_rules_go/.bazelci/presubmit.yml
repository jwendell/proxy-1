---
platforms:
  ubuntu1604:
    bazel: 0.23.0 # test minimum supported version of bazel on ubuntu1404 only
    build_targets:
    - "..."
    test_targets:
    - "..."
  ubuntu1804:
    build_targets:
    - "..."
    test_targets:
    - "..."
  macos:
    build_targets:
    - "..."
    test_targets:
    - "..."
  rbe_ubuntu1604:
    build_targets:
    - "..."
    test_flags:
    # Some tests depend on this feature being disabled. However, because it's
    # enabled by default in the rbe_ubuntu1604 platform, we cannot simply remove
    # this flag here, we have to explicitly override it with 0.
    - "--action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=0"
    # go_bazel_test rules are marked local, since the executors don't have bazel
    # installed. It appears bazel is no longer in PATH on the host machines
    # in this configuration either.
    - "--test_tag_filters=-local"
    test_targets:
    - "--"
    - "..."
    - "-//tests/core/go_path:go_path_test"
    - "-//tests/core/stdlib:buildid_test"
  windows:
    build_flags:
    # Go requires a C toolchain that accepts options and emits errors like
    # gcc or clang. The Go SDK does not support MSVC.
    - "--cpu=x64_windows"
    - "--compiler=mingw-gcc"
    - '--action_env=PATH=PATH=C:\tools\msys64\usr\bin;C:\tools\msys64\bin;C:\tools\msys64\mingw64\bin;C:\python3\Scripts\;C:\python3;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0;C:\Windows\System32\OpenSSH;C:\ProgramData\GooGet;C:\Program Files\Google\Compute Engine\metadata_scripts;C:\Program Files (x86)\Google\Cloud SDK\google-cloud-sdk\bin;C:\Program Files\Google\Compute Engine\sysprep;C:\ProgramData\chocolatey\bin;C:\Program Files\Git\cmd;C:\tools\msys64\usr\bin;c:\openjdk\bin;C:\Program Files (x86)\Windows Kits\8.1\Windows Performance Toolkit\;C:\Program Files\CMake\bin;c:\ninja;c:\bazel;c:\buildkite'
    build_targets:
    # BUG(bazelbuild/bazel#6485): Bazel 0.18.0 crashes when loading
    # @com_google_protobuf//:protobuf. We have to exclude everything that
    # transitively depends on it.
    # TODO(#1787): There is a cc_import target in //tests/core/cgo that
    # doesn't set the interface_library attribute. This causes an
    # analysis failure.
    # BUG(#1788): There are link errors in several targets in //tests/core/race.
    # TODO(#1789): go_path tests that require symlinks fail. These should
    # be skipped automatically.
    # TODO(#1790): Tests that require data should use bazel.Runfile.
    - "--"
    - "..."
    - "-@com_github_golang_protobuf//ptypes:go_default_library_gen"
    - "-@com_google_protobuf//:any_proto"
    - "-@com_google_protobuf//:api_proto"
    - "-@com_google_protobuf//:compiler_plugin_proto"
    - "-@com_google_protobuf//:descriptor_proto"
    - "-@com_google_protobuf//:duration_proto"
    - "-@com_google_protobuf//:empty_proto"
    - "-@com_google_protobuf//:field_mask_proto"
    - "-@com_google_protobuf//:protobuf"
    - "-@com_google_protobuf//:protoc"
    - "-@com_google_protobuf//:protoc_lib"
    - "-@com_google_protobuf//:source_context_proto"
    - "-@com_google_protobuf//:struct_proto"
    - "-@com_google_protobuf//:timestamp_proto"
    - "-@com_google_protobuf//:type_proto"
    - "-@com_google_protobuf//:wrappers_proto"
    - "-@go_googleapis//google/rpc:code_go_proto"
    - "-@go_googleapis//google/rpc:code_proto"
    - "-@go_googleapis//google/rpc:errdetails_go_proto"
    - "-@go_googleapis//google/rpc:errdetails_proto"
    - "-@go_googleapis//google/rpc:status_go_proto"
    - "-@go_googleapis//google/rpc:status_proto"
    - "-@go_googleapis//google/type:color_go_proto"
    - "-@gogo_special_proto//github.com/gogo/protobuf/gogoproto:gogoproto"
    - "-//go/tools/bazel:go_default_test"
    - "-@io_bazel_rules_go//proto:gogofaster_proto"
    - "-@io_bazel_rules_go//proto:go_grpc"
    - "-@io_bazel_rules_go//proto:go_proto"
    - "-@io_bazel_rules_go//proto:go_proto_bootstrap"
    - "-@io_bazel_rules_go//proto:go_proto_validate"
    - "-@io_bazel_rules_go//proto/wkt:any_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:api_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:compiler_plugin_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:descriptor_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:duration_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:empty_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:field_mask_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:source_context_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:struct_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:timestamp_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:type_go_proto"
    - "-@io_bazel_rules_go//proto/wkt:wrappers_go_proto"
    - "-@org_golang_x_crypto//ed25519:go_default_test"
    - "-@org_golang_x_crypto//sha3:go_default_test"
    - "-@org_golang_x_sys//windows/registry:go_default_test"
    - "-@org_golang_x_sys//windows/svc/eventlog:go_default_test"
    - "-@org_golang_x_sys//windows/svc:go_default_test"
    - "-@org_golang_x_text//language:go_default_test"
    - "-@org_golang_x_tools//go/packages/packagestest:go_default_test"
    - "-//proto:combo_grpc"
    - "-//proto:combo_proto"
    - "-//proto:gofast_grpc"
    - "-//proto:gofast_proto"
    - "-//proto:gogofaster_grpc"
    - "-//proto:gogofaster_proto"
    - "-//proto:gogofast_grpc"
    - "-//proto:gogofast_proto"
    - "-//proto:gogo_grpc"
    - "-//proto:gogo_proto"
    - "-//proto:gogoslick_grpc"
    - "-//proto:gogoslick_proto"
    - "-//proto:gogotypes_grpc"
    - "-//proto:gogotypes_proto"
    - "-//proto:go_grpc"
    - "-//proto:go_proto"
    - "-//proto:go_proto_bootstrap"
    - "-//proto:go_proto_validate"
    - "-//proto:gostring_grpc"
    - "-//proto:gostring_proto"
    - "-//proto/wkt:any_go_proto"
    - "-//proto/wkt:api_go_proto"
    - "-//proto/wkt:compiler_plugin_go_proto"
    - "-//proto/wkt:descriptor_go_proto"
    - "-//proto/wkt:duration_go_proto"
    - "-//proto/wkt:empty_go_proto"
    - "-//proto/wkt:field_mask_go_proto"
    - "-//proto/wkt:source_context_go_proto"
    - "-//proto/wkt:struct_go_proto"
    - "-//proto/wkt:timestamp_go_proto"
    - "-//proto/wkt:type_go_proto"
    - "-//proto/wkt:wrappers_go_proto"
    - "-@test_chdir_remote//sub:go_default_test"
    - "-//tests/core/cgo:dylib_client"
    - "-//tests/core/cgo:dylib_test"
    - "-//tests/core/cgo:versioned_dylib_client"
    - "-//tests/core/cgo:versioned_dylib_test"
    - "-//tests/core/coverage:coverage_test_test"
    - "-//tests/core/coverage:cross_cover_test_test"
    - "-//tests/core/cross:cross_test"
    - "-//tests/core/go_binary:go_default_test"
    - "-//tests/core/go_path:go_path"
    - "-//tests/core/go_path:go_path_test"
    - "-//tests/core/go_path:nodata_path"
    - "-//tests/core/go_path:link_path"
    - "-//tests/core/go_path:copy_path"
    - "-//tests/core/go_path:archive_path"
    - "-//tests/core/go_path/pkg/lib:vendored"
    - "-//tests/core/go_path/pkg/lib:go_default_test"
    - "-//tests/core/go_path/pkg/lib:go_default_library"
    - "-//tests/core/go_path/pkg/lib:embed_test"
    - "-//tests/core/go_path/pkg/lib:embed_lib"
    - "-//tests/core/go_path/cmd/bin:cross"
    - "-//tests/core/go_path/cmd/bin:bin"
    - "-//tests/core/go_plugin:go_plugin"
    - "-//tests/core/go_plugin:go_default_test"
    - "-//tests/core/go_plugin:plugin"
    - "-//tests/core/go_proto_library:bar_go_proto"
    - "-//tests/core/go_proto_library:bar_proto"
    - "-//tests/core/go_proto_library:embed_go_proto"
    - "-//tests/core/go_proto_library:embed_test"
    - "-//tests/core/go_proto_library:foo_go_proto"
    - "-//tests/core/go_proto_library:foo_proto"
    - "-//tests/core/go_proto_library_importmap:foo_go_proto"
    - "-//tests/core/go_proto_library_importmap:foo_proto"
    - "-//tests/core/go_proto_library_importmap:importmap_test"
    - "-//tests/core/go_proto_library:transitive_go_proto"
    - "-//tests/core/go_proto_library:transitive_test"
    - "-//tests/core/go_proto_library:wrap_lib"
    - "-//tests/core/go_test:data_test"
    - "-//tests/core/go_test:pwd_test"
    - "-//tests/core/nogo/custom:custom_analyzers_custom_config"
    - "-//tests/core/nogo/custom:custom_analyzers_default_config"
    - "-//tests/core/nogo/custom:custom_analyzers_no_errors"
    - "-//tests/core/nogo/deps:dep_graph"
    - "-//tests/core/nogo/vet:vet_default"
    - "-//tests/core/nogo/vet:vet_enabled_has_errors"
    - "-//tests/core/nogo/vet:vet_enabled_no_errors"
    - "-//tests/core/output_groups:compilation_outputs_test"
    - "-//tests/core/race:race_bin"
    - "-//tests/core/race:race_feature_test"
    - "-//tests/core/race:race_on_test"
    - "-//tests/core/stdlib:buildid_test"
    - "-//tests/examples/executable_name:executable_name"
    - "-//tests/integration/googleapis:color_service"
    - "-//tests/integration/googleapis:color_service_go_proto"
    - "-//tests/integration/googleapis:color_service_proto"
    - "-//tests/integration/googleapis:color_service_test"
    - "-//tests/legacy/build_with_old_sdk:build_with_old_sdk"
    - "-//tests/legacy/cgo_library_root_dir:cgo_library_root_dir"
    - "-//tests/legacy/custom_go_toolchain:custom_go_toolchain"
    - "-//tests/legacy/examples/cgo/example_command:example_command_test"
    - "-//tests/legacy/examples/cgo/example_command:example_command_script"
    - "-//tests/legacy/examples/cgo/example_command:example_command"
    - "-//tests/legacy/examples/cgo:generate_go_src"
    - "-//tests/legacy/examples/cgo:cgo_lib_test"
    - "-//tests/legacy/examples/cgo:go_default_library"
    - "-//tests/legacy/examples/cgo/cc_dependency:version"
    - "-//tests/legacy/examples/cgo/cc_dependency:c_version_so"
    - "-//tests/legacy/examples/cgo/cc_dependency:c_version_orig"
    - "-//tests/legacy/examples/cgo:sub"
    - "-//tests/legacy/examples/proto/dep:useful_go_proto"
    - "-//tests/legacy/examples/proto/dep:useful_proto"
    - "-//tests/legacy/examples/proto/embed:embed_go_proto"
    - "-//tests/legacy/examples/proto/embed:embed_proto"
    - "-//tests/legacy/examples/proto/embed:go_default_library"
    - "-//tests/legacy/examples/proto:go_default_library"
    - "-//tests/legacy/examples/proto/gogo:gogo_test"
    - "-//tests/legacy/examples/proto/gogo:values_go_proto"
    - "-//tests/legacy/examples/proto/gogo:values_proto"
    - "-//tests/legacy/examples/proto/gostyle:gostyle_go_proto"
    - "-//tests/legacy/examples/proto/gostyle:gostyle_proto"
    - "-//tests/legacy/examples/proto/grpc:my_svc_go_proto"
    - "-//tests/legacy/examples/proto/grpc:my_svc_proto"
    - "-//tests/legacy/examples/proto/grpc:not_grpc"
    - "-//tests/legacy/examples/proto/grpc:test_grpc"
    - "-//tests/legacy/examples/proto/lib:lib_go_proto"
    - "-//tests/legacy/examples/proto/lib:lib_proto"
    - "-//tests/legacy/examples/proto:proto_pure_test"
    - "-//tests/legacy/examples/proto:proto_test"
    - "-//tests/legacy/extldflags_rpath:extldflags_rpath_test"
    - "-//tests/legacy/go_embed_data:go_default_test"
    - "-//tests/legacy/go_embed_data:go_default_library"
    - "-//tests/legacy/go_embed_data:unpack"
    - "-//tests/legacy/go_embed_data:str"
    - "-//tests/legacy/go_embed_data:single"
    - "-//tests/legacy/go_embed_data:local"
    - "-//tests/legacy/go_embed_data:flat"
    - "-//tests/legacy/go_embed_data:ext"
    - "-//tests/legacy/go_embed_data:empty"
    - "-//tests/legacy/go_embed_data:embedded_zip"
    - "-//tests/legacy/go_embed_data:embedded_tar"
    - "-//tests/legacy/info:info"
    - "-//tests/legacy/proto_ignore_go_package_option:a_go_proto"
    - "-//tests/legacy/proto_ignore_go_package_option:a_proto"
    - "-//tests/legacy/proto_ignore_go_package_option:b_go_proto"
    - "-//tests/legacy/proto_ignore_go_package_option:b_proto"
    - "-//tests/legacy/test_chdir:go_default_test"
    - "-//tests/legacy/test_filter_test:test_filter_test"
    - "-//tests/legacy/test_rundir:go_default_test"
    - "-//tests/legacy/transitive_data:go_default_test"
    - "-//tests/reproducibility:go_default_test"
    - "-//tests/reproducibility:reproducibility"
    test_flags:
    # Go requires a C toolchain that accepts options and emits errors like
    # gcc or clang. The Go SDK does not support MSVC.
    - "--cpu=x64_windows"
    - "--compiler=mingw-gcc"
    - '--action_env=PATH=PATH=C:\tools\msys64\usr\bin;C:\tools\msys64\bin;C:\tools\msys64\mingw64\bin;C:\python3\Scripts\;C:\python3;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0;C:\Windows\System32\OpenSSH;C:\ProgramData\GooGet;C:\Program Files\Google\Compute Engine\metadata_scripts;C:\Program Files (x86)\Google\Cloud SDK\google-cloud-sdk\bin;C:\Program Files\Google\Compute Engine\sysprep;C:\ProgramData\chocolatey\bin;C:\Program Files\Git\cmd;C:\tools\msys64\usr\bin;c:\openjdk\bin;C:\Program Files (x86)\Windows Kits\8.1\Windows Performance Toolkit\;C:\Program Files\CMake\bin;c:\ninja;c:\bazel;c:\buildkite'
    # On Windows CI, bazel (bazelisk) needs %LocalAppData% to find the cache directory.
    # We invoke bazel in tests, so the tests need this, too.
    - "--test_env=LOCALAPPDATA"
    test_targets:
    - "--"
    - "..."
    - "-//go/tools/bazel:go_default_test"
    - "-@org_golang_x_crypto//ed25519:go_default_test"
    - "-@org_golang_x_crypto//sha3:go_default_test"
    - "-@org_golang_x_net//ipv4:go_default_test"
    - "-@org_golang_x_sys//windows/registry:go_default_test"
    - "-@org_golang_x_sys//windows/svc/eventlog:go_default_test"
    - "-@org_golang_x_sys//windows/svc:go_default_test"
    - "-@org_golang_x_text//language:go_default_test"
    - "-@org_golang_x_tools//cmd/splitdwarf/internal/macho:go_default_test"
    - "-@org_golang_x_tools//go/packages/packagestest:go_default_test"
    - "-@test_chdir_remote//sub:go_default_test"
    - "-//tests/core/cgo/objc:objc_test"
    - "-//tests/core/cgo:race_test"
    - "-//tests/core/cgo:opts_test"
    - "-//tests/core/cgo:opts"
    - "-//tests/core/cgo:dylib_test"
    - "-//tests/core/cgo:dylib_client"
    - "-//tests/core/cgo:versioned_dylib_test"
    - "-//tests/core/cgo:versioned_dylib_client"
    - "-//tests/core/cgo:cc_libs_test"
    - "-//tests/core/cgo:pure"
    - "-//tests/core/cgo:cc_srcs"
    - "-//tests/core/cgo:cc_deps"
    - "-//tests/core/cgo:c_srcs"
    - "-//tests/core/cgo:bar_dep"
    - "-//tests/core/cgo:tag_test" # TODO(#2031): FindBinary does not work
    - "-//tests/core/coverage:coverage_test_test"
    - "-//tests/core/coverage:cross_cover_test_test"
    - "-//tests/core/cross:cross_test"
    - "-//tests/core/go_binary:go_default_test"
    - "-//tests/core/go_binary:stamp_test"
    - "-//tests/core/go_path:go_path"
    - "-//tests/core/go_path:go_path_test"
    - "-//tests/core/go_path:link_path"
    - "-//tests/core/go_path/pkg/lib:embed_test"
    - "-//tests/core/go_path/pkg/lib:go_default_test"
    - "-//tests/core/go_plugin:go_plugin"
    - "-//tests/core/go_plugin:go_default_test"
    - "-//tests/core/go_plugin:plugin"
    - "-//tests/core/go_proto_library:embed_test"
    - "-//tests/core/go_proto_library_importmap:importmap_test"
    - "-//tests/core/go_proto_library:transitive_test"
    - "-//tests/core/go_test:data_test"
    - "-//tests/core/go_test:pwd_test"
    - "-//tests/core/nogo/config:pure_aspect_test"
    - "-//tests/core/nogo/coverage:coverage_test"
    - "-//tests/core/nogo/custom:custom_analyzers_custom_config"
    - "-//tests/core/nogo/custom:custom_analyzers_default_config"
    - "-//tests/core/nogo/custom:custom_analyzers_no_errors"
    - "-//tests/core/nogo/deps:dep_graph"
    - "-//tests/core/nogo/vet:vet_default"
    - "-//tests/core/nogo/vet:vet_enabled_has_errors"
    - "-//tests/core/nogo/vet:vet_enabled_no_errors"
    - "-//tests/core/output_groups:compilation_outputs_test"
    - "-//tests/core/race:race_auto_test"
    - "-//tests/core/race:race_bin"
    - "-//tests/core/race:race_feature_test"
    - "-//tests/core/race:race_on_test"
    - "-//tests/core/stdlib:buildid_test"
    - "-//tests/examples/executable_name:executable_name"
    - "-//tests/integration/googleapis:color_service_test"
    - "-//tests/legacy/build_with_old_sdk:build_with_old_sdk"
    - "-//tests/legacy/cgo_library_root_dir:cgo_library_root_dir"
    - "-//tests/legacy/custom_go_toolchain:custom_go_toolchain"
    - "-//tests/legacy/examples/cgo/example_command:example_command_test"
    - "-//tests/legacy/examples/cgo/example_command:example_command_script"
    - "-//tests/legacy/examples/cgo/example_command:example_command"
    - "-//tests/legacy/examples/cgo:generate_go_src"
    - "-//tests/legacy/examples/cgo:cgo_lib_test"
    - "-//tests/legacy/examples/cgo:go_default_library"
    - "-//tests/legacy/examples/cgo/cc_dependency:version"
    - "-//tests/legacy/examples/cgo/cc_dependency:c_version_so"
    - "-//tests/legacy/examples/cgo/cc_dependency:c_version_orig"
    - "-//tests/legacy/examples/cgo:sub"
    - "-//tests/legacy/examples/proto/gogo:gogo_test"
    - "-//tests/legacy/examples/proto:proto_pure_test"
    - "-//tests/legacy/examples/proto:proto_test"
    - "-//tests/legacy/extldflags_rpath:extldflags_rpath_test"
    - "-//tests/legacy/go_embed_data:go_default_test"
    - "-//tests/legacy/go_embed_data:go_default_test"
    - "-//tests/legacy/go_embed_data:go_default_library"
    - "-//tests/legacy/go_embed_data:unpack"
    - "-//tests/legacy/go_embed_data:str"
    - "-//tests/legacy/go_embed_data:single"
    - "-//tests/legacy/go_embed_data:local"
    - "-//tests/legacy/go_embed_data:flat"
    - "-//tests/legacy/go_embed_data:ext"
    - "-//tests/legacy/go_embed_data:empty"
    - "-//tests/legacy/go_embed_data:embedded_zip"
    - "-//tests/legacy/go_embed_data:embedded_tar"
    - "-//tests/legacy/info:info"
    - "-//tests/legacy/test_chdir:go_default_test"
    - "-//tests/legacy/test_filter_test:test_filter_test"
    - "-//tests/legacy/test_rundir:go_default_test"
    - "-//tests/legacy/transitive_data:go_default_test"
    - "-//tests/reproducibility:go_default_test"
    - "-//tests/reproducibility:reproducibility"
